<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cibercapilla Católica - UCN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,300..900;1,300..900&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* Tipografía y Colores Base */
        body { 
            font-family: 'Crimson Pro', serif; 
            background-color: #fdfbf7; 
            color: #1c1917; 
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(217, 119, 6, 0.03) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(180, 83, 9, 0.03) 0%, transparent 20%);
        }
        
        .font-sans { font-family: 'Inter', sans-serif; }
        
        /* Tarjetas "Papel Sagrado" */
        .glass { 
            background: #ffffff; 
            border: 1px solid rgba(231, 229, 228, 0.8);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .glass:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
        }

        /* Botones de Navegación */
        .nav-btn {
            background: white;
            border: 1px solid #e7e5e4;
            color: #57534e;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .active-tab { 
            background-color: #d97706 !important; 
            color: white !important; 
            border-color: #d97706 !important;
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.25);
            transform: translateY(-1px);
        }

        /* Velas Mejoradas - COLOR ROJO ALTO CONTRASTE */
        .candle-container { perspective: 1000px; }
        .candle-body {
            width: 44px;
            height: 110px;
            border-radius: 8px;
            position: relative;
            background: linear-gradient(to right, #ef4444, #dc2626, #b91c1c); /* Rojo Litúrgico */
            border: 1px solid rgba(0,0,0,0.1);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .candle-wick {
            width: 3px;
            height: 10px;
            background: #44403c;
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .candle-flame {
            position: absolute;
            top: -42px;
            left: 50%;
            transform: translateX(-50%);
            width: 22px;
            height: 38px;
            background: radial-gradient(ellipse at bottom, #fde047 0%, #f59e0b 50%, transparent 80%);
            border-radius: 50% 50% 20% 20%;
            filter: blur(0.5px);
            animation: flicker 2s ease-in-out infinite alternate;
            opacity: 0.9;
            transform-origin: bottom center;
        }

        @keyframes flicker {
            0% { transform: translateX(-50%) scale(1) skewX(-2deg); opacity: 0.85; }
            25% { transform: translateX(-50%) scale(1.05) skewX(2deg); opacity: 1; }
            50% { transform: translateX(-50%) scale(0.95) skewX(-1deg); opacity: 0.85; }
            75% { transform: translateX(-50%) scale(1.02) skewX(1deg); opacity: 0.95; }
            100% { transform: translateX(-50%) scale(1) skewX(0deg); opacity: 0.9; }
        }

        .hidden-tab { display: none !important; }
        .animate-fade-in { animation: fadeIn 0.6s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Animación suave para el banner */
        .banner-transition {
            transition: opacity 0.5s ease-in-out, height 0.5s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen pb-24">

    <!-- Header -->
    <header class="bg-white/90 backdrop-blur-md sticky top-0 z-50 border-b border-stone-200 shadow-sm">
        <div class="max-w-6xl mx-auto px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-4">
                <div class="bg-gradient-to-br from-amber-500 to-amber-600 text-white p-3 rounded-xl shadow-lg shadow-amber-500/20">
                    <i data-lucide="cross" class="w-8 h-8"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-black uppercase tracking-tight text-stone-900 leading-none">Cibercapilla</h1>
                    <p class="text-[11px] uppercase tracking-[0.3em] font-sans font-bold text-amber-700 mt-1">UCN • Fidelidad al Evangelio</p>
                </div>
            </div>
            
            <a href="https://ucn.edu.co/consultame" target="_blank" class="group flex items-center gap-3 bg-stone-900 hover:bg-stone-800 text-white px-6 py-3 rounded-full text-xs font-bold font-sans uppercase tracking-wider transition-all shadow-md hover:shadow-xl transform hover:-translate-y-0.5">
                <i data-lucide="users" class="w-4 h-4 text-amber-400"></i> 
                <span>Asesoría Espiritual</span>
            </a>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 mt-6">
        <!-- Navegación "Pills" -->
        <nav class="flex flex-wrap justify-center gap-3 mb-8 font-sans overflow-x-auto pb-2 px-2">
            <button onclick="switchTab('altar')" class="nav-btn active-tab flex items-center gap-2 px-6 py-3 rounded-full text-xs uppercase tracking-widest shadow-sm">
                <i data-lucide="flame" class="w-4 h-4"></i> Altar
            </button>
            <button onclick="switchTab('eucaristia')" class="nav-btn flex items-center gap-2 px-6 py-3 rounded-full text-xs uppercase tracking-widest shadow-sm">
                <i data-lucide="video" class="w-4 h-4"></i> Eucaristía
            </button>
            <button onclick="switchTab('rosario')" class="nav-btn flex items-center gap-2 px-6 py-3 rounded-full text-xs uppercase tracking-widest shadow-sm">
                <i data-lucide="sparkles" class="w-4 h-4"></i> Rosario
            </button>
            <button onclick="switchTab('coronilla')" class="nav-btn flex items-center gap-2 px-6 py-3 rounded-full text-xs uppercase tracking-widest shadow-sm">
                <i data-lucide="heart" class="w-4 h-4"></i> Coronilla
            </button>
            <button onclick="switchTab('misericordia')" class="nav-btn flex items-center gap-2 px-6 py-3 rounded-full text-xs uppercase tracking-widest shadow-sm">
                <i data-lucide="hand-helping" class="w-4 h-4"></i> Misericordia
            </button>
            <button onclick="switchTab('papa')" class="nav-btn flex items-center gap-2 px-6 py-3 rounded-full text-xs uppercase tracking-widest shadow-sm">
                <i data-lucide="globe" class="w-4 h-4"></i> Papa
            </button>
            <button onclick="switchTab('biblia')" class="nav-btn flex items-center gap-2 px-6 py-3 rounded-full text-xs uppercase tracking-widest shadow-sm">
                <i data-lucide="book-open" class="w-4 h-4"></i> Biblia
            </button>
            <button onclick="switchTab('muro')" class="nav-btn flex items-center gap-2 px-6 py-3 rounded-full text-xs uppercase tracking-widest shadow-sm">
                <i data-lucide="message-square" class="w-4 h-4"></i> Peticiones
            </button>
        </nav>

        <!-- Banner Religioso SUPERIOR (Solo visible en Altar) -->
        <div id="mainBanner" class="banner-transition max-w-6xl mx-auto px-2 mb-12 animate-fade-in">
            <div class="relative h-48 md:h-64 rounded-[2.5rem] overflow-hidden shadow-xl group border border-stone-100 bg-stone-900">
                <img id="bannerImageTop" src="https://images.unsplash.com/photo-1548625361-7887e1cc092e?q=80&w=2000&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 opacity-90 group-hover:opacity-100 group-hover:scale-105 transform duration-[2s]" alt="Banner Religioso">
                <div class="absolute inset-0 bg-gradient-to-t from-stone-900/90 via-stone-900/30 to-transparent flex items-end p-8 md:p-12">
                    <div class="max-w-2xl relative z-10">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="w-8 h-[2px] bg-amber-400"></span>
                            <p class="text-amber-300 text-xs font-bold uppercase tracking-[0.3em] font-sans">Reflexión Diaria</p>
                        </div>
                        <p class="text-white text-xl md:text-3xl font-serif italic leading-tight drop-shadow-lg">"Yo soy el camino, y la verdad, y la vida; nadie viene al Padre, sino por mí."</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="tabContent" class="min-h-[60vh] pb-12">
            
            <!-- Tab: Altar -->
            <section id="tab-altar" class="text-center animate-fade-in space-y-12">
                <div class="max-w-4xl mx-auto p-10 bg-white rounded-[2.5rem] border border-stone-200 shadow-sm relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-amber-300 via-orange-400 to-amber-300"></div>
                    <p class="text-2xl italic font-light leading-relaxed text-stone-800">
                        ¡Bienvenidos a la Cibercapilla de la Fundación Universitaria Católica del Norte! Nos complace recibirlos en este espacio virtual dedicado a la reflexión, la oración y el encuentro con la persona adorable de Jesucristo.
                    </p>
                </div>
                <div class="space-y-4">
                    <h2 class="text-4xl font-serif italic text-stone-900">Altar de Intenciones</h2>
                    <p class="text-xs font-black uppercase tracking-[0.3em] text-stone-400 font-sans">Haz clic sobre una vela para encenderla y realizar la oración</p>
                </div>
                <div class="flex flex-wrap justify-center gap-16 pt-8" id="candlesGrid"></div>
                <div id="candlePrayer" class="mt-12 p-10 rounded-[2.5rem] bg-white border border-amber-100 max-w-2xl mx-auto hidden shadow-xl animate-fade-in text-center">
                    <i data-lucide="quote" class="w-8 h-8 text-amber-200 mx-auto mb-4 fill-current"></i>
                    <p class="text-2xl italic font-medium leading-relaxed text-stone-800" id="prayerText"></p>
                </div>
            </section>

            <!-- Tab: Eucaristía -->
            <section id="tab-eucaristia" class="hidden-tab max-w-4xl mx-auto space-y-8 animate-fade-in">
                <div class="p-12 rounded-[3rem] bg-white border border-stone-200 text-center shadow-lg">
                    <div class="w-20 h-20 bg-amber-50 rounded-full flex items-center justify-center mx-auto mb-8 border border-amber-100">
                        <i data-lucide="video" class="text-amber-600 w-10 h-10"></i>
                    </div>
                    <h2 class="text-4xl font-serif italic mb-2 text-stone-900">La Santa Eucaristía</h2>
                    <p class="text-stone-500 font-sans text-sm font-bold uppercase tracking-wider mb-8">Transmisión en Vivo</p>
                    
                    <div class="bg-stone-50 p-8 rounded-3xl border border-stone-200 mb-8 inline-block w-full max-w-2xl">
                        <div class="mb-8">
                            <p class="text-4xl font-black text-stone-800 font-sans mb-1">12:00 m. (Col)</p>
                            <p class="text-amber-600 font-bold uppercase tracking-widest text-xs">Todos los días</p>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
                            <a href="https://www.facebook.com/SoyCatolicaDelNorte" target="_blank" class="flex items-center justify-center gap-3 bg-[#1877F2] hover:bg-blue-700 text-white px-8 py-4 rounded-2xl text-sm font-bold shadow-lg shadow-blue-200 transition-all font-sans transform hover:-translate-y-1">
                                <i data-lucide="facebook"></i> Ver en Facebook
                            </a>
                            <a href="https://encuestas.ucn.edu.co/index.php/819977" target="_blank" class="flex items-center justify-center gap-3 bg-stone-800 hover:bg-black text-white px-8 py-4 rounded-2xl text-sm font-bold shadow-lg shadow-stone-200 transition-all font-sans transform hover:-translate-y-1">
                                <i data-lucide="pencil"></i> Enviar Intenciones
                            </a>
                        </div>

                        <div class="border-t border-stone-200 pt-6">
                            <p class="text-stone-600 italic font-serif text-lg">"Yo soy el pan vivo que ha bajado del cielo; el que coma de este pan vivirá para siempre."</p>
                            <p class="text-xs text-stone-400 font-bold mt-2 uppercase tracking-widest">(Jn 6, 51)</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab: Rosario -->
            <section id="tab-rosario" class="hidden-tab max-w-4xl mx-auto animate-fade-in">
                <div class="p-8 md:p-14 rounded-[3rem] bg-white border border-stone-200 shadow-xl relative overflow-hidden">
                    <div id="rosaryProgress" class="absolute top-0 left-0 h-2 bg-amber-500 transition-all duration-700" style="width: 0%"></div>
                    <div class="flex justify-between items-start mb-10 border-b border-stone-100 pb-6">
                        <div class="flex flex-col gap-1">
                            <span id="rosaryStepIndicator" class="text-xs font-black uppercase tracking-widest text-amber-600 font-sans"></span>
                            <h2 id="rosaryStepTitle" class="text-4xl font-serif italic text-stone-900 font-medium"></h2>
                        </div>
                        <button onclick="resetRosary()" class="p-3 bg-stone-50 rounded-2xl text-stone-400 hover:text-amber-600 transition-colors"><i data-lucide="rotate-ccw" class="w-6 h-6"></i></button>
                    </div>
                    <div class="min-h-[300px] flex flex-col justify-center text-center px-4">
                        <p id="rosaryInstruction" class="text-xs uppercase tracking-[0.3em] text-stone-400 mb-8 font-black font-sans"></p>
                        <p id="rosaryText" class="text-3xl italic leading-relaxed font-light text-stone-800 whitespace-pre-line"></p>
                        <div id="rosarySubPrayers" class="mt-10 animate-fade-in"></div>
                    </div>
                    <div class="flex justify-between items-center mt-12 pt-8 border-t border-stone-100 font-sans">
                        <button id="rosaryPrev" onclick="moveRosary(-1)" class="flex items-center gap-2 text-sm font-bold text-stone-400 hover:text-stone-800 disabled:opacity-30 px-4 py-2 rounded-lg hover:bg-stone-50 transition-colors"><i data-lucide="chevron-left" class="w-5 h-5"></i> Anterior</button>
                        <button id="rosaryNext" onclick="moveRosary(1)" class="flex items-center gap-3 bg-amber-600 hover:bg-amber-700 text-white px-10 py-4 rounded-2xl text-sm font-bold transition-all shadow-lg shadow-amber-200 transform hover:-translate-y-1">Siguiente <i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                    </div>
                </div>
                <div class="text-center mt-6">
                    <span id="rosaryDayInfo" class="text-[11px] font-black uppercase tracking-[0.2em] text-amber-800 font-sans bg-amber-50 border border-amber-100 py-3 px-8 rounded-full shadow-sm"></span>
                </div>
            </section>

            <!-- Tab: Coronilla -->
            <section id="tab-coronilla" class="hidden-tab max-w-4xl mx-auto animate-fade-in">
                <div class="p-8 md:p-14 rounded-[3rem] bg-white border border-stone-200 shadow-xl relative overflow-hidden">
                    <div id="coronillaProgress" class="absolute top-0 left-0 h-2 bg-red-600 transition-all duration-700" style="width: 0%"></div>
                    <div class="flex justify-between items-start mb-10 border-b border-stone-100 pb-6">
                        <div class="flex flex-col gap-1">
                            <span id="coronillaStepIndicator" class="text-xs font-black uppercase tracking-widest text-red-600 font-sans"></span>
                            <h2 id="coronillaStepTitle" class="text-3xl font-serif italic text-stone-900">La Divina Misericordia</h2>
                        </div>
                        <button onclick="resetCoronilla()" class="p-3 bg-stone-50 rounded-2xl text-stone-400 hover:text-red-600 transition-colors"><i data-lucide="rotate-ccw" class="w-6 h-6"></i></button>
                    </div>
                    <div class="min-h-[300px] flex flex-col justify-center text-center px-4">
                        <p id="coronillaInstruction" class="text-xs uppercase tracking-[0.3em] text-stone-400 mb-8 font-black font-sans"></p>
                        <p id="coronillaText" class="text-3xl italic leading-relaxed font-light text-stone-800 whitespace-pre-line"></p>
                        <div id="coronillaSubPrayers" class="mt-10 animate-fade-in"></div>
                    </div>
                    <div class="flex justify-between items-center mt-12 pt-8 border-t border-stone-100 font-sans">
                        <button id="coronillaPrev" onclick="moveCoronilla(-1)" class="flex items-center gap-2 text-sm font-bold text-stone-400 hover:text-stone-800 disabled:opacity-30 px-4 py-2 rounded-lg hover:bg-stone-50 transition-colors"><i data-lucide="chevron-left" class="w-5 h-5"></i> Anterior</button>
                        <button id="coronillaNext" onclick="moveCoronilla(1)" class="flex items-center gap-3 bg-red-700 hover:bg-red-800 text-white px-10 py-4 rounded-2xl text-sm font-bold transition-all shadow-lg shadow-red-200 transform hover:-translate-y-1">Siguiente <i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                    </div>
                </div>
            </section>

            <!-- Tab: Misericordia (Actualizado con Iconos) -->
            <section id="tab-misericordia" class="hidden-tab max-w-6xl mx-auto space-y-12 animate-fade-in">
                <div class="text-center mb-16">
                    <h2 class="text-5xl font-serif italic mb-4 text-stone-900">Obras de Misericordia</h2>
                    <p class="text-stone-500 font-sans font-bold uppercase tracking-[0.2em] text-xs">"Tuve hambre, y me disteis de comer..." (Mt 25, 35)</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-10">
                    <div class="space-y-6">
                        <h3 class="flex items-center gap-3 text-amber-700 font-black uppercase tracking-widest text-xs border-b-2 border-amber-200 pb-4 font-sans">
                            <i data-lucide="hand-helping" class="w-5 h-5"></i> Corporales
                        </h3>
                        <div id="corporalGrid" class="grid gap-4"></div>
                    </div>
                    <div class="space-y-6">
                        <h3 class="flex items-center gap-3 text-indigo-700 font-black uppercase tracking-widest text-xs border-b-2 border-indigo-200 pb-4 font-sans">
                            <i data-lucide="sparkles" class="w-5 h-5"></i> Espirituales
                        </h3>
                        <div id="spiritualGrid" class="grid gap-4"></div>
                    </div>
                </div>
            </section>

            <!-- Tab: Papa -->
            <section id="tab-papa" class="hidden-tab max-w-4xl mx-auto animate-fade-in">
                <div class="p-14 rounded-[3rem] bg-white border border-stone-200 text-center shadow-lg">
                    <div class="flex flex-col items-center">
                        <div class="w-24 h-24 bg-amber-100 rounded-full flex items-center justify-center mb-8 shadow-inner">
                            <i data-lucide="globe" class="text-amber-600 w-12 h-12"></i>
                        </div>
                        <h2 class="text-4xl font-serif italic text-stone-900 mb-2">Intención del Papa</h2>
                        <p id="papaMonthName" class="text-amber-700 font-black uppercase tracking-[0.4em] text-[10px] mb-8 font-sans bg-amber-50 px-6 py-2 rounded-full"></p>
                    </div>
                    <div class="p-12 bg-stone-50 rounded-[2.5rem] border border-stone-200">
                        <p id="papaIntentionTitle" class="text-2xl font-bold text-stone-800 mb-6 font-sans"></p>
                        <p id="papaIntentionDesc" class="text-xl italic leading-relaxed text-stone-600 font-medium"></p>
                    </div>
                </div>
            </section>

            <!-- Tab: Biblia -->
            <section id="tab-biblia" class="hidden-tab max-w-6xl mx-auto animate-fade-in">
                <div class="mb-8 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <button id="bibleBackBtn" onclick="bibleBack()" class="hidden p-3 bg-white border border-stone-200 rounded-xl hover:bg-stone-50 transition-colors shadow-sm"><i data-lucide="arrow-left" class="w-5 h-5 text-stone-600"></i></button>
                        <h2 id="bibleTitle" class="text-3xl font-serif italic text-stone-900">Sagradas Escrituras</h2>
                    </div>
                </div>
                <div id="bibleLibrary" class="grid gap-12"></div>
                <div id="bibleChapters" class="hidden p-12 bg-white rounded-[3rem] border border-stone-200 shadow-lg">
                    <p class="text-center text-xs font-bold uppercase tracking-[0.3em] text-stone-400 mb-10 font-sans">Selecciona el capítulo</p>
                    <div id="chapterGrid" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-10 gap-3 font-sans"></div>
                </div>
                <div id="bibleReader" class="hidden p-12 md:p-20 bg-white rounded-[3rem] border border-stone-200 min-h-[500px] shadow-xl relative">
                    <div id="bibleLoading" class="flex flex-col items-center justify-center h-[300px] gap-6">
                        <div class="w-16 h-16 border-4 border-amber-100 border-t-amber-500 rounded-full animate-spin"></div>
                        <p class="text-xs uppercase tracking-widest text-stone-400 animate-pulse font-sans font-bold">Consultando la Palabra...</p>
                    </div>
                    <div id="bibleContent" class="hidden max-w-3xl mx-auto">
                        <div class="mb-12 pb-8 border-b border-stone-100 flex justify-between items-center sticky top-0 bg-white/95 backdrop-blur-sm py-4 z-10">
                            <h3 id="readingBookTitle" class="text-3xl font-serif italic text-stone-900"></h3>
                            <div class="flex gap-2">
                                <button onclick="changeChapter(-1)" id="prevChapter" class="p-3 bg-stone-50 rounded-xl hover:bg-stone-100 transition-colors"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                                <button onclick="changeChapter(1)" id="nextChapter" class="p-3 bg-stone-50 rounded-xl hover:bg-stone-100 transition-colors"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                            </div>
                        </div>
                        <div id="readingText" class="text-2xl leading-[1.8] text-stone-800 space-y-8 font-medium font-serif"></div>
                    </div>
                </div>
            </section>

            <!-- Tab: Peticiones -->
            <section id="tab-muro" class="hidden-tab max-w-3xl mx-auto space-y-8 animate-fade-in">
                <div class="p-10 rounded-[3rem] bg-white border border-stone-200 shadow-xl">
                    <h3 class="text-2xl font-serif italic mb-8 text-stone-900 text-center">Muro de Intenciones</h3>
                    <div class="space-y-6">
                        <textarea id="prayerInput" placeholder="Escribe aquí tu petición..." class="w-full bg-stone-50 border border-stone-200 rounded-3xl p-6 outline-none h-40 text-xl text-stone-700 italic focus:border-amber-400 focus:bg-white transition-all shadow-inner placeholder:text-stone-300"></textarea>
                        <button onclick="savePrayer()" class="w-full bg-stone-900 hover:bg-black text-white py-5 rounded-2xl font-black uppercase tracking-widest text-xs transition-all shadow-lg transform hover:-translate-y-1">Depositar intención</button>
                    </div>
                </div>
                <div id="prayersList" class="grid gap-4"></div>
            </section>

        </div>

        <!-- Banner Religioso INFERIOR (Visible en otras pestañas) -->
        <div id="bottomBanner" class="banner-transition hidden max-w-6xl mx-auto px-2 mb-12 opacity-0 h-0">
            <div class="relative h-48 md:h-64 rounded-[2.5rem] overflow-hidden shadow-xl group border border-stone-100 bg-stone-900">
                <img id="bannerImageBottom" src="https://images.unsplash.com/photo-1548625361-7887e1cc092e?q=80&w=2000&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 opacity-90 group-hover:opacity-100 group-hover:scale-105 transform duration-[2s]" alt="Banner Religioso">
                <div class="absolute inset-0 bg-gradient-to-t from-stone-900/90 via-stone-900/30 to-transparent flex items-end p-8 md:p-12">
                    <div class="max-w-2xl relative z-10">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="w-8 h-[2px] bg-amber-400"></span>
                            <p class="text-amber-300 text-xs font-bold uppercase tracking-[0.3em] font-sans">Reflexión Diaria</p>
                        </div>
                        <p class="text-white text-xl md:text-3xl font-serif italic leading-tight drop-shadow-lg">"Yo soy el camino, y la verdad, y la vida; nadie viene al Padre, sino por mí."</p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <footer class="fixed bottom-0 w-full p-4 border-t border-stone-200 bg-white/95 z-40 backdrop-blur-lg">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center px-4 gap-4 text-[10px] uppercase tracking-widest font-bold font-sans text-stone-400">
            <div class="flex items-center gap-2"><i data-lucide="sparkles" class="text-amber-500 w-3 h-3"></i> Católica del Norte</div>
            <div class="italic text-stone-300">"Todo lo puedo en Aquel que me fortalece"</div>
        </div>
    </footer>

    <script>
        const apiKey = ""; 
        let currentTab = 'altar';
        
        const bibleBooksMapping = {
            "Génesis": "Genesis", "Éxodo": "Exodus", "Levítico": "Leviticus", "Números": "Numbers", "Deuteronomio": "Deuteronomy",
            "Josué": "Joshua", "Jueces": "Judges", "Rut": "Ruth", "1 Samuel": "1 Samuel", "2 Samuel": "2 Samuel",
            "1 Reyes": "1 Kings", "2 Reyes": "2 Kings", "1 Crónicas": "1 Chronicles", "2 Crónicas": "2 Chronicles",
            "Esdras": "Ezra", "Nehemías": "Nehemiah", "Ester": "Esther", "Job": "Job", "Salmos": "Psalms", "Proverbios": "Proverbs",
            "Eclesiastés": "Ecclesiastes", "Cantares": "Song of Solomon", "Isaías": "Isaiah", "Jeremías": "Jeremiah", 
            "Lamentaciones": "Lamentations", "Ezequiel": "Ezekiel", "Daniel": "Daniel", "Oseas": "Hosea", "Joel": "Joel", 
            "Amós": "Amos", "Abdías": "Obadiah", "Jonás": "Jonah", "Miqueas": "Micah", "Nahúm": "Nahum", "Habacuc": "Habakkuk",
            "Sofonías": "Zephaniah", "Ageo": "Haggai", "Zacarías": "Zechariah", "Malaquías": "Malachi",
            "Mateo": "Matthew", "Marcos": "Mark", "Lucas": "Luke", "Juan": "John", "Hechos": "Acts", "Romanos": "Romans",
            "1 Corintios": "1 Corinthians", "2 Corintios": "2 Corinthians", "Gálatas": "Galatians", "Efesios": "Ephesians",
            "Filipenses": "Philippians", "Colosenses": "Colossians", "1 Tesalonicenses": "1 Thessalonians", 
            "2 Tesalonicenses": "2 Thessalonians", "1 Timoteo": "1 Timothy", "2 Timoteo": "2 Timothy", "Tito": "Titus",
            "Filemón": "Philemon", "Hebreos": "Hebrews", "Santiago": "James", "1 Pedro": "1 Peter", "2 Pedro": "2 Peter",
            "1 Juan": "1 John", "2 Juan": "2 John", "3 Juan": "3 John", "Judas": "Jude", "Apocalipsis": "Revelation"
        };
        
        const OFFLINE_BIBLE_DATA = {
            "default": `1 Bienaventurado el varón que no anduvo en consejo de malos,
            Ni estuvo en camino de pecadores,
            Ni en silla de escarnecedores se ha sentado;
            2 Sino que en la ley de Jehová está su delicia,
            Y en su ley medita de día y de noche.
            3 Será como árbol plantado junto a corrientes de aguas,
            Que da su fruto en su tiempo,
            Y su hoja no cae;
            Y todo lo que hace prosperará.`,
            "Génesis 1": `1 En el principio creó Dios los cielos y la tierra.
            2 Y la tierra estaba desordenada y vacía, y las tinieblas estaban sobre la faz del abismo, y el Espíritu de Dios se movía sobre la faz de las aguas.
            3 Y dijo Dios: Sea la luz; y fue la luz.
            4 Y vio Dios que la luz era buena; y separó Dios la luz de las tinieblas.`,
            "Salmos 23": `1 Jehová es mi pastor; nada me faltará.
            2 En lugares de delicados pastos me hará descansar; Junto a aguas de reposo me pastoreará.
            3 Confortará mi alma; Me guiará por sendas de justicia por amor de su nombre.
            4 Aunque ande en valle de sombra de muerte, No temeré mal alguno, porque tú estarás conmigo; Tu vara y tu cayado me infundirán aliento.`,
            "Juan 3": `16 Porque de tal manera amó Dios al mundo, que ha dado a su Hijo unigénito, para que todo aquel que en él cree, no se pierda, mas tenga vida eterna.
            17 Porque no envió Dios a su Hijo al mundo para condenar al mundo, sino para que el mundo sea salvo por él.`
        };

        const bibleData = {
            "Nuevo Testamento": [
                { name: "Mateo", chapters: 28, isGospel: true }, { name: "Marcos", chapters: 16, isGospel: true }, { name: "Lucas", chapters: 24, isGospel: true }, { name: "Juan", chapters: 21, isGospel: true },
                { name: "Hechos", chapters: 28 }, { name: "Romanos", chapters: 16 }, { name: "1 Corintios", chapters: 16 }, { name: "2 Corintios", chapters: 13 },
                { name: "Gálatas", chapters: 6 }, { name: "Efesios", chapters: 6 }, { name: "Filipenses", chapters: 4 }, { name: "Colosenses", chapters: 4 },
                { name: "1 Tesalonicenses", chapters: 5 }, { name: "2 Tesalonicenses", chapters: 3 }, { name: "1 Timoteo", chapters: 6 }, { name: "2 Timoteo", chapters: 4 },
                { name: "Tito", chapters: 3 }, { name: "Filemón", chapters: 1 }, { name: "Hebreos", chapters: 13 }, { name: "Santiago", chapters: 5 },
                { name: "1 Pedro", chapters: 5 }, { name: "2 Pedro", chapters: 3 }, { name: "1 Juan", chapters: 5 }, { name: "2 Juan", chapters: 1 }, { name: "3 Juan", chapters: 1 },
                { name: "Judas", chapters: 1 }, { name: "Apocalipsis", chapters: 22 }
            ],
            "Antiguo Testamento": [
                { name: "Génesis", chapters: 50 }, { name: "Éxodo", chapters: 40 }, { name: "Levítico", chapters: 27 }, { name: "Números", chapters: 36 }, { name: "Deuteronomio", chapters: 34 },
                { name: "Josué", chapters: 24 }, { name: "Jueces", chapters: 21 }, { name: "Rut", chapters: 4 }, { name: "1 Samuel", chapters: 31 }, { name: "2 Samuel", chapters: 24 },
                { name: "1 Reyes", chapters: 22 }, { name: "2 Reyes", chapters: 25 }, { name: "1 Crónicas", chapters: 29 }, { name: "2 Crónicas", chapters: 36 }, { name: "Esdras", chapters: 10 },
                { name: "Nehemías", chapters: 13 }, { name: "Ester", chapters: 10 }, { name: "Job", chapters: 42 }, { name: "Salmos", chapters: 150 }, { name: "Proverbios", chapters: 31 }, 
                { name: "Eclesiastés", chapters: 12 }, { name: "Cantares", chapters: 8 }, { name: "Isaías", chapters: 66 }, { name: "Jeremías", chapters: 52 },
                { name: "Lamentaciones", chapters: 5 }, { name: "Ezequiel", chapters: 48 }, { name: "Daniel", chapters: 14 }, { name: "Oseas", chapters: 14 },
                { name: "Joel", chapters: 3 }, { name: "Amós", chapters: 9 }, { name: "Abdías", chapters: 1 }, { name: "Jonás", chapters: 4 }, { name: "Miqueas", chapters: 7 },
                { name: "Nahúm", chapters: 3 }, { name: "Habacuc", chapters: 3 }, { name: "Sofonías", chapters: 3 }, { name: "Ageo", chapters: 2 }, { name: "Zacarías", chapters: 14 }, { name: "Malaquías", chapters: 4 }
            ]
        };

        const candles = [
            { id: 1, label: 'Almas del Purgatorio', prayer: 'Que la luz perpetua las ilumine en su descanso eterno. Amén.' },
            { id: 2, label: 'Salud de los Enfermos', prayer: 'Señor Jesús, visita a los que sufren y dales tu alivio soberano. Amén.' },
            { id: 3, label: 'Por las Familias', prayer: 'Sagrada Familia, haz de nuestros hogares iglesias domésticas de paz. Amén.' },
            { id: 4, label: 'Paz en el Mundo', prayer: 'Haz de mí un instrumento de tu paz donde hay guerra. Amén.' },
            { id: 5, label: 'Acción de Gracias', prayer: 'Te damos gracias por el don de la vida y tu amor sin fin. Amén.' },
        ];

        // Se han agregado iconos específicos para cada obra de misericordia
        const misericordiaData = {
            corporales: [
                { title: "Visitar a los enfermos", tip: "Llamar o visitar a quien esté pasando por un mal momento de salud.", icon: "stethoscope" },
                { title: "Dar de comer al hambriento", tip: "Compartir alimentos con los necesitados o bancos de comida.", icon: "utensils-crossed" },
                { title: "Dar de beber al sediento", tip: "Cuidar el agua y colaborar en proyectos de acceso a ella.", icon: "glass-water" },
                { title: "Dar posada al peregrino", tip: "Acoger y orientar con calidez a los nuevos compañeros o extranjeros.", icon: "door-open" },
                { title: "Vestir al desnudo", tip: "Donar ropa en buen estado a fundaciones o personas necesitadas.", icon: "shirt" },
                { title: "Visitar a los presos", tip: "Rezar por la libertad espiritual y conversión de quienes están cautivos.", icon: "lock" },
                { title: "Enterrar a los difuntos", tip: "Acompañar con caridad y oración a las familias que atraviesan un duelo.", icon: "flower-2" }
            ],
            espirituales: [
                { title: "Enseñar al que no sabe", tip: "Ayudar a un compañero con temas académicos difíciles o compartir conocimientos.", icon: "book-open" },
                { title: "Dar buen consejo", tip: "Escuchar con empatía y orientar con valores cristianos a quien pide ayuda.", icon: "lightbulb" },
                { title: "Corregir al que yerra", tip: "Hacer observaciones fraternas siempre desde el amor y la mansedumbre.", icon: "user-check" },
                { title: "Perdonar las injurias", tip: "Soltar rencores y buscar la reconciliación tras un conflicto.", icon: "heart-handshake" },
                { title: "Consolar al triste", tip: "Dedicar tiempo a escuchar a alguien que se siente solo o desanimado.", icon: "smile" },
                { title: "Sufrir con paciencia los defectos", tip: "Tener tolerancia con las limitaciones ajenas en el día a día.", icon: "hourglass" },
                { title: "Rogar por los vivos y difuntos", tip: "Orar diariamente por las intenciones del mundo y la salvación de las almas.", icon: "star" }
            ]
        };

        const oraciones = {
            padreNuestro: "Padre nuestro, que estás en el cielo, santificado sea tu Nombre; venga a nosotros tu reino; hágase tu voluntad en la tierra como en el cielo. Danos hoy nuestro pan de cada día; perdona nuestras ofensas, como también nosotros perdonamos a los que nos ofenden; no nos dejes caer en la tentación, y líbranos del mal. Amén.",
            aveMaria: "Dios te salve, María, llena eres de gracia, el Señor es contigo. Bendita tú eres entre todas las mujeres y bendito es el fruto de tu vientre, Jesús. Santa María, Madre de Dios, ruega por nosotros, pecadores, ahora y en la hora de nuestra muerte. Amén.",
            gloria: "Gloria al Padre, y al Hijo, y al Espíritu Santo. Como era en el principio, ahora y siempre, por los siglos de los siglos. Amén.",
            fatima: "¡Oh Jesús mío! Perdona nuestros pecados, líbranos del fuego del infierno, lleva al cielo a todas las almas, especialmente a las más necesitadas de tu divina misericordia. Amén.",
            salve: "Dios te salve, Reina y Madre de misericordia, vida, dulzura y esperanza nuestra; Dios te salve. A ti llamamos los desterrados hijos de Eva; a ti suspiramos, gimiendo y llorando, en este valle de lágrimas. Ea, pues, Señora, abogada nuestra, vuelve a nosotros esos tus ojos misericordiosos; y después de este destierro muéstranos a Jesús, fruto bendito de tu vientre. ¡Oh clementísima, oh piadosa, oh dulce siempre Virgen María! Ruega por nosotros, Santa Madre de Dios. Amén.",
            credo: "Creo en Dios, Padre Todopoderoso, Creador del cielo y de la tierra. Creo en Jesucristo, su único Hijo, Nuestro Señor, que fue concebido por obra y gracia del Espíritu Santo, nació de Santa María Virgen, padeció bajo el poder de Poncio Pilato, fue crucificado, muerto y sepultado, descendió a los infiernos, al tercer día resucitó de entre los muertos, subió a los cielos y está sentado a la derecha de Dios, Padre Todopoderoso. Desde allí ha de venir a juzgar a vivos y muertos. Creo en el Espíritu Santo, la santa Iglesia Católica, la comunión de los santos, el perdón de los pecados, la resurrección de la carne y la vida eterna. Amén."
        };

        const misteriosLibro = {
            gozosos: ["La Encarnación del Hijo de Dios", "La Visitación de María a su prima Santa Isabel", "El Nacimiento del Hijo de Dios en el portal de Belén", "La Purificación de la Virgen y Presentación del Niño Jesús en el Templo", "El Niño Jesús perdido y hallado en el Templo"],
            dolorosos: ["La Oración de Jesús en el Huerto de los Olivos", "La Flagelación de Nuestro Señor Jesucristo", "La Coronación de Espinas", "Jesús carga con la Cruz camino del Calvario", "La Crucifixión y Muerte de Nuestro Señor"],
            gloriosos: ["La Triunfante Resurrección de Jesús", "La Ascensión de Jesús al Cielo", "La Venida del Espíritu Santo sobre los Apóstoles", "La Asunción de la Virgen María en cuerpo y alma al cielo", "La Coronación de María como Reina de todo lo creado"],
            luminosos: ["El Bautismo de Jesús en el Jordán", "La Autorrevelación de Jesús en las bodas de Caná", "El Anuncio del Reino de Dios invitando a la conversión", "La Transfiguración del Señor", "La Institución de la Eucaristía"]
        };

        const papaIntentions = [
            { month: "Enero", title: "Por los educadores", desc: "Oremos para que los educadores sean testigos creíbles, enseñando la fraternidad en lugar de la confrontación y ayudando especialmente a los jóvenes más vulnerables." },
            { month: "Febrero", title: "Por los enfermos terminales", desc: "Oremos para que los enfermos terminales y sus familias reciban siempre los cuidados y el acompañamiento necesarios, tanto desde el punto de vista médico como humano." },
            { month: "Marzo", title: "Por los nuevos mártires", desc: "Oremos para que quienes en diversas partes del mundo arriesgan su vida por el Evangelio contagien a la Iglesia su valentía y su impulso misionero." },
            { month: "Abril", title: "Por el papel de la mujer", desc: "Oremos para que la dignidad y la riqueza de las mujeres sean reconocidas en todas las culturas, y para que cese la discriminación que sufren en diversas partes del mundo." },
            { month: "Mayo", title: "Por la formación de religiosos y seminaristas", desc: "Oremos para que los religiosos, las religiosas y los seminaristas crezcan en su camino vocacional a través de una formación humana, pastoral, espiritual y comunitaria." },
            { month: "Junio", title: "Por los que huyen de su país", desc: "Oremos para que los migrantes que huyen de las guerras o del hambre, obligados a viajes llenos de peligro y violencia, encuentren aceptación y nuevas oportunidades de vida." },
            { month: "Julio", title: "Por los ancianos", desc: "Oremos para que los ancianos, que representan las raíces y la memoria de un pueblo, sean valorados por su experiencia y sabiduría, y para que su testimonio ayude a los jóvenes a mirar el futuro con esperanza." },
            { month: "Agosto", title: "Por los líderes políticos", desc: "Oremos para que los líderes políticos estén al servicio de su propio pueblo, trabajando por el desarrollo humano integral y el bien común, atendiendo a los que han perdido su empleo y dando prioridad a los más pobres." },
            { month: "Septiembre", title: "Por el clamor de la Tierra", desc: "Oremos para que cada uno de nosotros escuche con el corazón el clamor de la Tierra y de las víctimas de las catástrofes ambientales y de la crisis climática." },
            { month: "Octubre", title: "Por una misión compartida", desc: "Oremos para que la Iglesia siga apoyando por todos los medios un estilo de vida sinodal, bajo el signo de la corresponsabilidad, fomentando la participación, la comunión y la misión compartida." },
            { month: "Noviembre", title: "Por quienes han perdido un hijo", desc: "Oremos para que todos los padres que lloran la muerte de un hijo o una hija encuentren apoyo en la comunidad y obtengan del Espíritu Consolador la paz del corazón." },
            { month: "Diciembre", title: "Por los voluntarios", desc: "Oremos para que las organizaciones de voluntariado y de promoción humana encuentren personas deseosas de comprometerse con el bien común y busquen caminos siempre nuevos de colaboración a nivel internacional." }
        ];

        const coronillaSequence = [
            { title: "Inicio", instruction: "Haz la Señal de la Cruz", text: "Por la señal de la Santa Cruz, de nuestros enemigos líbranos, Señor, Dios nuestro. En el nombre del Padre, y del Hijo, y del Espíritu Santo. Amén." },
            { title: "Oraciones Iniciales", instruction: "Reza el Padre Nuestro, Ave María y Credo", text: "Padre Nuestro...\nAve María...\nCredo de los Apóstoles..." },
            { title: "Decena 1", instruction: "Cuentas de la Coronilla", isCoronillaDecena: true },
            { title: "Decena 2", instruction: "Cuentas de la Coronilla", isCoronillaDecena: true },
            { title: "Decena 3", instruction: "Cuentas de la Coronilla", isCoronillaDecena: true },
            { title: "Decena 4", instruction: "Cuentas de la Coronilla", isCoronillaDecena: true },
            { title: "Decena 5", instruction: "Cuentas de la Coronilla", isCoronillaDecena: true },
            { title: "Conclusión", instruction: "Repite 3 veces", text: "Santo Dios, Santo Fuerte, Santo Inmortal, ten piedad de nosotros y del mundo entero." },
            { title: "Jaculatoria Final", instruction: "En Ti confío", text: "Oh Sangre y Agua que brotaste del Corazón de Jesús como una fuente de misericordia para nosotros, en Ti confío.\n\nJesús, en Ti confío." }
        ];

        const bannerImages = [
            "https://images.unsplash.com/photo-1548625361-7887e1cc092e?q=80&w=2000&auto=format&fit=crop", 
            "https://images.unsplash.com/photo-1515162305285-0293e4767cc2?q=80&w=2000&auto=format&fit=crop", 
            "https://images.unsplash.com/photo-1438232992991-995b7058bbb3?q=80&w=2000&auto=format&fit=crop", 
            "https://images.unsplash.com/photo-1447023029226-ef8f6b52e3ea?q=80&w=2000&auto=format&fit=crop"  
        ];
        let currentBannerImageIndex = 0;
        let litCandles = new Set();
        let rosaryStep = 0;
        let coronillaStep = 0;
        let selectedBook = null;
        let selectedChapter = 1;
        let peticiones = JSON.parse(localStorage.getItem('peticiones') || '[]');

        window.onload = () => {
            lucide.createIcons();
            renderCandles();
            renderBibleLibrary();
            renderPrayers();
            renderMisericordia();
            updateRosary();
            updateCoronilla();
            updatePapaIntention();
            initBannerRotation();
        };

        function switchTab(tabId) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden-tab'));
            document.getElementById(`tab-${tabId}`).classList.remove('hidden-tab');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-tab'));
            const clickedBtn = Array.from(document.querySelectorAll('.nav-btn')).find(b => b.getAttribute('onclick').includes(tabId));
            if(clickedBtn) clickedBtn.classList.add('active-tab');
            currentTab = tabId;

            const mainBanner = document.getElementById('mainBanner');
            const bottomBanner = document.getElementById('bottomBanner');
            
            // Lógica de Banner: Arriba en Altar, Abajo en los demás
            if (tabId === 'altar') {
                mainBanner.classList.remove('hidden');
                mainBanner.style.opacity = '1';
                mainBanner.style.height = 'auto';
                
                bottomBanner.classList.add('hidden');
                bottomBanner.style.opacity = '0';
                bottomBanner.style.height = '0';
            } else {
                mainBanner.classList.add('hidden');
                mainBanner.style.opacity = '0';
                mainBanner.style.height = '0';

                bottomBanner.classList.remove('hidden');
                // Pequeño retardo para animación suave
                setTimeout(() => {
                    bottomBanner.style.opacity = '1';
                    bottomBanner.style.height = 'auto';
                }, 50);
            }
        }

        function initBannerRotation() {
            const imgTop = document.getElementById('bannerImageTop');
            const imgBottom = document.getElementById('bannerImageBottom');
            
            if (!imgTop || !imgBottom) return;

            setInterval(() => {
                imgTop.style.opacity = '0';
                imgBottom.style.opacity = '0';
                
                setTimeout(() => {
                    currentBannerImageIndex = (currentBannerImageIndex + 1) % bannerImages.length;
                    const nextImg = bannerImages[currentBannerImageIndex];
                    imgTop.src = nextImg;
                    imgBottom.src = nextImg;
                    
                    setTimeout(() => {
                        imgTop.style.opacity = '0.9';
                        imgBottom.style.opacity = '0.9';
                    }, 100);
                }, 1000);
            }, 8000);
        }

        function renderCandles() {
            const grid = document.getElementById('candlesGrid');
            grid.innerHTML = candles.map(c => {
                const isLit = litCandles.has(c.id);
                return `
                <div class="candle-container">
                    <button onclick="toggleCandle(${c.id})" class="flex flex-col items-center group relative transform transition-transform hover:scale-105">
                        <div class="relative h-32 flex flex-col items-center justify-end">
                            <div class="absolute top-0 w-24 h-24 bg-amber-400/20 rounded-full blur-2xl transition-opacity duration-1000 ${isLit ? 'opacity-100' : 'opacity-0'}"></div>
                            <div class="relative ${isLit ? '' : 'hidden'}">
                                <div class="candle-wick"></div>
                                <div id="flame-${c.id}" class="candle-flame"></div>
                            </div>
                            <div class="candle-body ${isLit ? 'shadow-[0_0_20px_rgba(251,191,36,0.3)]' : ''}" style="opacity: ${isLit ? '1' : '0.9'};"></div>
                        </div>
                        <span class="mt-5 text-[11px] font-black uppercase tracking-widest transition-colors duration-300 font-sans ${isLit ? 'text-amber-600 scale-105' : 'text-stone-400 group-hover:text-amber-500'}">${c.label}</span>
                    </button>
                </div>`;
            }).join('');
        }

        function toggleCandle(id) {
            if (litCandles.has(id)) { litCandles.delete(id); document.getElementById('candlePrayer').classList.add('hidden'); }
            else { litCandles.add(id); document.getElementById('candlePrayer').classList.remove('hidden'); document.getElementById('prayerText').innerText = `"${candles.find(c => c.id === id).prayer}"`; }
            renderCandles();
        }

        function renderMisericordia() {
            const corpGrid = document.getElementById('corporalGrid');
            const spirGrid = document.getElementById('spiritualGrid');
            
            // Función auxiliar para generar tarjetas con iconos
            const createCard = (o, colorClass, iconColor) => `
                <div class="p-5 bg-white rounded-2xl border border-stone-200 shadow-sm hover:shadow-md transition-all group flex gap-4 items-start">
                    <div class="p-3 bg-${colorClass}-50 rounded-xl group-hover:bg-${colorClass}-100 transition-colors">
                        <i data-lucide="${o.icon}" class="w-6 h-6 text-${iconColor}-600"></i>
                    </div>
                    <div>
                        <h4 class="text-${iconColor}-700 font-black mb-1 font-sans text-sm uppercase tracking-wide">${o.title}</h4>
                        <p class="text-sm text-stone-600 italic leading-relaxed">${o.tip}</p>
                    </div>
                </div>
            `;

            corpGrid.innerHTML = misericordiaData.corporales.map(o => createCard(o, 'amber', 'amber')).join('');
            spirGrid.innerHTML = misericordiaData.espirituales.map(o => createCard(o, 'indigo', 'indigo')).join('');
            
            lucide.createIcons(); // Refrescar iconos nuevos
        }

        function getMisteriosHoy() {
            const day = new Date().getDay();
            if (day === 1 || day === 6) return { tipo: "Gozosos", lista: misteriosLibro.gozosos };
            if (day === 2 || day === 5) return { tipo: "Dolorosos", lista: misteriosLibro.dolorosos };
            if (day === 3 || day === 0) return { tipo: "Gloriosos", lista: misteriosLibro.gloriosos };
            return { tipo: "Luminosos", lista: misteriosLibro.luminosos };
        }

        function getRosarySequence() {
            const misterios = getMisteriosHoy();
            const seq = [
                { title: "Inicio", instruction: "Señal de la Cruz", text: "Por la señal de la Santa Cruz, de nuestros enemigos líbranos, Señor, Dios nuestro. En el nombre del Padre, y del Hijo, y del Espíritu Santo. Amén." },
                { title: "Acto de Contrición", instruction: "Pide perdón", text: "Jesús, mi Señor y Redentor, yo me arrepiento de todos los pecados que he cometido hasta hoy, y me pesa de todo corazón, porque con ellos he ofendido a un Dios tan bueno. Propongo firmemente no volver a pecar y confío que por tu infinita misericordia me has de conceder el perdón de mis culpas y me has de llevar a la vida eterna. Amén." }
            ];
            misterios.lista.forEach((m, i) => seq.push({ title: `Misterio ${i + 1}`, instruction: `Meditemos el Misterio ${misterios.tipo}`, text: m, isMystery: true }));
            seq.push({ title: "La Salve", instruction: "Oración final", text: oraciones.salve });
            seq.push({ title: "Finalización", instruction: "Bajo tu amparo", text: "Bajo tu amparo nos acogemos, santa Madre de Dios; no deseches las súplicas que te dirigimos en nuestras necesidades, antes bien, líbranos de todo peligro, ¡oh Virgen siempre gloriosa y benedicta! Amén." });
            return seq;
        }

        function updateRosary() {
            const seq = getRosarySequence();
            const step = seq[rosaryStep];
            document.getElementById('rosaryProgress').style.width = `${(rosaryStep / (seq.length - 1)) * 100}%`;
            document.getElementById('rosaryStepIndicator').innerText = `Paso ${rosaryStep + 1} de ${seq.length}`;
            document.getElementById('rosaryStepTitle').innerText = step.title;
            document.getElementById('rosaryInstruction').innerText = step.instruction;
            document.getElementById('rosaryText').innerText = step.text;
            const sub = document.getElementById('rosarySubPrayers');
            if (step.isMystery) {
                sub.classList.remove('hidden');
                sub.innerHTML = `<div class="p-6 bg-amber-50 rounded-2xl border border-amber-100 text-left"><p class="text-xs font-black uppercase text-amber-800 mb-3 font-sans">En cada misterio:</p><div class="space-y-4"><div class="pl-3 border-l-2 border-amber-200"><p class="text-xs font-bold text-amber-700 uppercase mb-1">Padre Nuestro</p><p class="text-sm text-stone-600 italic">${oraciones.padreNuestro}</p></div><div class="pl-3 border-l-2 border-amber-200"><p class="text-xs font-bold text-amber-700 uppercase mb-1">Ave María (10 veces)</p><p class="text-sm text-stone-600 italic">${oraciones.aveMaria}</p></div><div class="pl-3 border-l-2 border-amber-200"><p class="text-xs font-bold text-amber-700 uppercase mb-1">Gloria y Jaculatoria</p><p class="text-sm text-stone-600 italic">${oraciones.gloria}<br><br>${oraciones.fatima}</p></div></div></div>`;
            } else sub.classList.add('hidden');
            document.getElementById('rosaryDayInfo').innerText = `Hoy es ${new Intl.DateTimeFormat('es-ES', { weekday: 'long' }).format(new Date())}: Misterios ${getMisteriosHoy().tipo}`;
            const nextBtn = document.getElementById('rosaryNext');
            nextBtn.innerHTML = rosaryStep === seq.length - 1 ? 'Terminar' : 'Siguiente <i data-lucide="chevron-right" class="w-4 h-4"></i>';
            nextBtn.onclick = rosaryStep === seq.length - 1 ? resetRosary : () => moveRosary(1);
            document.getElementById('rosaryPrev').disabled = rosaryStep === 0;
        }
        function moveRosary(dir) { rosaryStep += dir; updateRosary(); }
        function resetRosary() { rosaryStep = 0; updateRosary(); }

        function updateCoronilla() {
            const step = coronillaSequence[coronillaStep];
            document.getElementById('coronillaProgress').style.width = `${(coronillaStep / (coronillaSequence.length - 1)) * 100}%`;
            document.getElementById('coronillaStepIndicator').innerText = `Paso ${coronillaStep + 1} de ${coronillaSequence.length}`;
            document.getElementById('coronillaStepTitle').innerText = step.title;
            document.getElementById('coronillaInstruction').innerText = step.instruction;
            document.getElementById('coronillaText').innerText = step.isCoronillaDecena ? "Misterio de la Misericordia" : step.text;
            const sub = document.getElementById('coronillaSubPrayers');
            if (step.isCoronillaDecena) {
                sub.classList.remove('hidden');
                sub.innerHTML = `<div class="p-6 bg-red-50 rounded-2xl border border-red-100 text-left"><p class="text-xs font-black uppercase text-red-800 mb-3 font-sans">En cada decena:</p><div class="space-y-4"><div class="pl-3 border-l-2 border-red-200"><p class="text-xs font-bold text-red-700 uppercase mb-1">Cuenta Grande</p><p class="text-sm text-stone-600 italic">"Padre Eterno, te ofrezco el Cuerpo y la Sangre, el Alma y la Divinidad de Tu Amadísimo Hijo..."</p></div><div class="pl-3 border-l-2 border-red-200"><p class="text-xs font-bold text-red-700 uppercase mb-1">Cuentas Pequeñas (10 veces)</p><p class="text-sm text-stone-600 italic">"Por Su dolorosa Pasión, ten misericordia de nosotros y del mundo entero."</p></div></div></div>`;
            } else if (step.title === "Oraciones Iniciales") {
                sub.classList.remove('hidden');
                sub.innerHTML = `<div class="space-y-3 text-left p-6 bg-stone-50 rounded-2xl border border-stone-200"><p class="text-sm text-stone-700 italic"><span class="font-bold text-amber-700">Padre Nuestro:</span> ${oraciones.padreNuestro}</p><p class="text-sm text-stone-700 italic"><span class="font-bold text-amber-700">Ave María:</span> ${oraciones.aveMaria}</p><p class="text-sm text-stone-700 italic"><span class="font-bold text-amber-700">Credo:</span> ${oraciones.credo}</p></div>`;
            } else sub.classList.add('hidden');
            const nextBtn = document.getElementById('coronillaNext');
            nextBtn.innerHTML = coronillaStep === coronillaSequence.length - 1 ? 'Terminar' : 'Siguiente <i data-lucide="chevron-right" class="w-4 h-4"></i>';
            nextBtn.onclick = coronillaStep === coronillaSequence.length - 1 ? resetCoronilla : () => moveCoronilla(1);
            document.getElementById('coronillaPrev').disabled = coronillaStep === 0;
        }
        function moveCoronilla(dir) { coronillaStep += dir; updateCoronilla(); }
        function resetCoronilla() { coronillaStep = 0; updateCoronilla(); }

        function updatePapaIntention() {
            const intention = papaIntentions[new Date().getMonth()];
            document.getElementById('papaMonthName').innerText = intention.month;
            document.getElementById('papaIntentionTitle').innerText = intention.title;
            document.getElementById('papaIntentionDesc').innerText = intention.desc;
        }

        function renderBibleLibrary() {
            const lib = document.getElementById('bibleLibrary');
            lib.innerHTML = Object.entries(bibleData).map(([test, books]) => `
                <div class="mb-8"><h3 class="text-stone-400 uppercase tracking-[0.3em] text-[10px] font-black border-b border-stone-200 pb-3 mb-6 font-sans">${test}</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">${books.map(b => `<button onclick="openBook('${b.name}', ${b.chapters})" class="p-5 bg-white rounded-2xl border border-stone-200 hover:border-amber-400 hover:shadow-md transition-all text-sm font-bold font-sans text-stone-700 text-left flex justify-between items-center ${b.isGospel ? 'border-amber-200 bg-amber-50/50' : ''}"><span>${b.name}</span>${b.isGospel ? '<i data-lucide="sparkles" class="w-3 h-3 text-amber-500"></i>' : ''}</button>`).join('')}</div></div>`).join('');
            lucide.createIcons();
        }

        function openBook(name, chapters) {
            selectedBook = { name, chapters };
            document.getElementById('bibleLibrary').classList.add('hidden');
            document.getElementById('bibleChapters').classList.remove('hidden');
            document.getElementById('bibleBackBtn').classList.remove('hidden');
            document.getElementById('bibleTitle').innerText = name;
            const grid = document.getElementById('chapterGrid');
            grid.innerHTML = Array.from({ length: chapters }, (_, i) => i + 1).map(num => `<button onclick="readChapter(${num})" class="w-full aspect-square flex items-center justify-center rounded-xl bg-stone-50 border border-stone-200 hover:bg-amber-500 hover:text-white hover:border-amber-500 transition-all text-sm font-bold font-sans text-stone-600">${num}</button>`).join('');
        }

        function bibleBack() {
            const lib = document.getElementById('bibleLibrary');
            const chapters = document.getElementById('bibleChapters');
            const reader = document.getElementById('bibleReader');
            if (!reader.classList.contains('hidden')) {
                reader.classList.add('hidden');
                chapters.classList.remove('hidden');
            } else {
                chapters.classList.add('hidden');
                lib.classList.remove('hidden');
                document.getElementById('bibleBackBtn').classList.add('hidden');
                document.getElementById('bibleTitle').innerText = "Sagradas Escrituras";
            }
        }

        function getOfflineText(book, chapter) {
            const key = `${book} ${chapter}`;
            if (OFFLINE_BIBLE_DATA[key]) return OFFLINE_BIBLE_DATA[key];
            if (book === "Salmos" && chapter === 23) return OFFLINE_BIBLE_DATA["Salmos 23"];
            if (book === "Génesis" && chapter === 1) return OFFLINE_BIBLE_DATA["Génesis 1"];
            if (book === "Juan" && chapter === 3) return OFFLINE_BIBLE_DATA["Juan 3"];
            
            let content = "";
            for (let i = 1; i <= 15; i++) {
                content += `${i} Este es el versículo ${i} del capítulo ${chapter} del libro de ${book}. La palabra de Dios es viva y eficaz, y más cortante que toda espada de dos filos; y penetra hasta partir el alma y el espíritu, las coyunturas y los tuétanos, y discierne los pensamientos y las intenciones del corazón.\n`;
            }
            return content;
        }

        async function readChapter(num) {
            selectedChapter = num;
            document.getElementById('bibleChapters').classList.add('hidden');
            document.getElementById('bibleReader').classList.remove('hidden');
            document.getElementById('bibleLoading').classList.remove('hidden');
            document.getElementById('bibleContent').classList.add('hidden');

            const bookEnglishName = bibleBooksMapping[selectedBook.name] || selectedBook.name;
            const formattedBook = bookEnglishName.replace(/\s+/g, '+');
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 4000); 

                const url = `https://bible-api.com/${formattedBook}+${num}?translation=rv1909`;
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' },
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);

                if (!response.ok) throw new Error("API Error");
                
                const data = await response.json();
                
                displayContent(selectedBook.name, num, data.text);
                
            } catch (error) {
                const offlineText = getOfflineText(selectedBook.name, num);
                displayContent(selectedBook.name, num, offlineText, true);
            }
        }

        function displayContent(book, chapter, text, isOffline = false) {
             document.getElementById('bibleLoading').classList.add('hidden');
             document.getElementById('bibleContent').classList.remove('hidden');
             
             const title = isOffline ? `${book} ${chapter} <span class="text-sm text-amber-600 align-middle ml-2 font-sans bg-amber-50 px-2 py-1 rounded-md border border-amber-100">Modo Offline</span>` : `${book} ${chapter}`;
             document.getElementById('readingBookTitle').innerHTML = title;
             
             let htmlContent = text.replace(/\n\s*\n/g, '\n');
             
             if (isOffline && !text.includes("Jehová") && !text.includes("Dios") && !text.includes("Bienaventurado")) {
                 htmlContent = `<div class="p-6 bg-amber-50 border border-amber-100 rounded-xl text-amber-800 italic mb-8 flex items-start gap-3">
                    <i data-lucide="wifi-off" class="w-5 h-5 flex-shrink-0 mt-1"></i>
                    <div>
                        <p class="font-bold text-sm uppercase tracking-wider mb-1 font-sans">Sin conexión a internet</p>
                        <p class="text-sm opacity-80">No pudimos descargar el texto sagrado. Mostrando versículos referenciales de meditación.</p>
                    </div>
                 </div>` + htmlContent;
             }
             
             document.getElementById('readingText').innerText = ""; 
             document.getElementById('readingText').innerHTML = htmlContent.replace(/\n/g, '<br><br>');
             
             if(isOffline) lucide.createIcons();
        }

        function changeChapter(dir) { const n = selectedChapter + dir; if (n > 0 && n <= selectedBook.chapters) readChapter(n); }

        function renderPrayers() { document.getElementById('prayersList').innerHTML = peticiones.map(p => `<div class="p-6 bg-white rounded-2xl border border-stone-200 border-l-4 border-l-amber-500 shadow-sm animate-fade-in"><p class="text-lg italic font-normal text-stone-800">"${p.text}"</p><span class="text-[10px] font-bold text-stone-400 uppercase tracking-widest mt-3 block font-sans">${p.date}</span></div>`).join(''); }
        function savePrayer() {
            const text = document.getElementById('prayerInput').value;
            if (text.trim()) {
                peticiones.unshift({ id: Date.now(), text, date: new Date().toLocaleDateString() });
                localStorage.setItem('peticiones', JSON.stringify(peticiones));
                document.getElementById('prayerInput').value = '';
                renderPrayers();
            }
        }
    </script>
</body>
</html>
