<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cibercapilla Católica - UCN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,200..900;1,200..900&family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Crimson Pro', serif; transition: background-color 0.5s ease; }
        .font-sans { font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .light .glass { background: rgba(0, 0, 0, 0.02); border: 1px solid rgba(0, 0, 0, 0.05); }
        
        .candle-container { perspective: 1000px; }
        .candle-body {
            width: 38px;
            height: 100px;
            border-radius: 6px 6px 4px 4px;
            position: relative;
            transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .candle-wick {
            width: 2px;
            height: 8px;
            background: #222;
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .candle-flame {
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            width: 18px;
            height: 32px;
            background: linear-gradient(to bottom, transparent 0%, #fbbf24 40%, #f59e0b 80%, #ea580c 100%);
            border-radius: 50% 50% 20% 20%;
            filter: blur(0.5px);
            animation: flicker 1.5s ease-in-out infinite alternate;
            transform-origin: bottom center;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.6), 0 0 40px rgba(251, 191, 36, 0.2);
        }

        .candle-flame::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 10px;
            background: rgba(59, 130, 246, 0.6); 
            border-radius: 50%;
            filter: blur(1px);
        }

        @keyframes flicker {
            0% { transform: translateX(-50%) scale(1) rotate(-1deg); opacity: 0.9; }
            20% { transform: translateX(-50%) scale(1.05) rotate(1deg); }
            40% { transform: translateX(-50%) scale(0.95) rotate(-0.5deg); opacity: 0.8; }
            60% { transform: translateX(-50%) scale(1.1) rotate(1.5deg); }
            80% { transform: translateX(-50%) scale(0.98) rotate(-1.5deg); opacity: 0.9; }
            100% { transform: translateX(-50%) scale(1) rotate(0.5deg); opacity: 1; }
        }

        .hidden-tab { display: none; }
        .active-tab { border-bottom: 2px solid #d97706; color: #d97706; opacity: 1; }
        
        .glow-effect {
            box-shadow: 0 10px 40px -10px rgba(251, 191, 36, 0.3);
        }

        .gospel-highlight {
            border: 1.5px solid #d97706 !important;
            background: rgba(217, 119, 6, 0.08) !important;
            box-shadow: 0 0 15px rgba(217, 119, 6, 0.1);
        }

        #apiModal { display: none; position: fixed; inset: 0; z-index: 100; background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 min-h-screen pb-20 overflow-x-hidden">

    <!-- Modal de API Key -->
    <div id="apiModal" class="flex items-center justify-center p-4">
        <div class="glass p-8 rounded-3xl max-w-md w-full border border-amber-500/20">
            <h3 class="text-xl font-bold mb-4">Configuración de la Biblia</h3>
            <p class="text-sm opacity-70 mb-6">Para ver los textos de la Biblia Latinoamericana en GitHub, necesitas una clave de Gemini API gratuita.</p>
            <input type="password" id="apiKeyInput" placeholder="Pega tu clave aquí..." class="w-full bg-slate-900 border border-white/10 rounded-xl p-3 mb-4 outline-none focus:border-amber-500 text-white">
            <div class="flex gap-3">
                <button onclick="saveApiKey()" class="flex-1 bg-amber-600 py-2 rounded-xl font-bold text-sm text-white">Guardar</button>
                <button onclick="closeApiModal()" class="flex-1 bg-white/5 py-2 rounded-xl font-bold text-sm">Cerrar</button>
            </div>
            <p class="text-[10px] mt-6 opacity-40">Obtén una clave gratis en: <a href="https://aistudio.google.com/app/apikey" target="_blank" class="underline">Google AI Studio</a></p>
        </div>
    </div>

    <!-- Header -->
    <header class="p-6 max-w-5xl mx-auto flex flex-col md:flex-row justify-between items-center border-b border-amber-500/20 mb-8 gap-4">
        <div class="flex items-center gap-3">
            <i data-lucide="cross" class="text-amber-500 w-8 h-8"></i>
            <div>
                <h1 class="text-xl font-bold tracking-tighter uppercase leading-none">Cibercapilla</h1>
                <p class="text-[10px] uppercase tracking-[0.2em] opacity-60 mt-1 font-sans">UCN - Fidelidad al Evangelio</p>
            </div>
        </div>
        
        <div class="flex gap-4 items-center font-sans">
            <button onclick="openApiModal()" class="p-2 rounded-full hover:bg-white/5 transition-colors opacity-40 hover:opacity-100" title="Configurar Biblia">
                <i data-lucide="settings" class="w-5 h-5"></i>
            </button>
            <a href="https://ucn.edu.co/consultame" target="_blank" class="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-full text-xs font-bold transition-all shadow-lg shadow-indigo-500/20">
                <i data-lucide="users" class="w-4 h-4"></i> Asesoría Espiritual
            </a>
            <button id="themeToggle" class="p-2 rounded-full hover:bg-amber-500/10 transition-colors">
                <i data-lucide="sun" id="themeIcon"></i>
            </button>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4">
        <!-- Navegación -->
        <nav class="flex flex-wrap justify-center gap-2 mb-10 font-sans">
            <button onclick="switchTab('altar')" class="nav-btn active-tab flex items-center gap-2 px-5 py-2.5 rounded-full text-xs uppercase tracking-widest opacity-60 hover:opacity-100">
                <i data-lucide="flame" class="w-4 h-4"></i> Altar
            </button>
            <button onclick="switchTab('eucaristia')" class="nav-btn flex items-center gap-2 px-5 py-2.5 rounded-full text-xs uppercase tracking-widest opacity-60 hover:opacity-100">
                <i data-lucide="video" class="w-4 h-4"></i> Eucaristía
            </button>
            <button onclick="switchTab('rosario')" class="nav-btn flex items-center gap-2 px-5 py-2.5 rounded-full text-xs uppercase tracking-widest opacity-60 hover:opacity-100">
                <i data-lucide="sparkles" class="w-4 h-4"></i> Rosario
            </button>
            <button onclick="switchTab('coronilla')" class="nav-btn flex items-center gap-2 px-5 py-2.5 rounded-full text-xs uppercase tracking-widest opacity-60 hover:opacity-100">
                <i data-lucide="heart" class="w-4 h-4"></i> Coronilla
            </button>
            <button onclick="switchTab('papa')" class="nav-btn flex items-center gap-2 px-5 py-2.5 rounded-full text-xs uppercase tracking-widest opacity-60 hover:opacity-100">
                <i data-lucide="globe" class="w-4 h-4"></i> Papa
            </button>
            <button onclick="switchTab('biblia')" class="nav-btn flex items-center gap-2 px-5 py-2.5 rounded-full text-xs uppercase tracking-widest opacity-60 hover:opacity-100">
                <i data-lucide="book-open" class="w-4 h-4"></i> Biblia
            </button>
            <button onclick="switchTab('muro')" class="nav-btn flex items-center gap-2 px-5 py-2.5 rounded-full text-xs uppercase tracking-widest opacity-60 hover:opacity-100">
                <i data-lucide="message-square" class="w-4 h-4"></i> Peticiones
            </button>
        </nav>

        <div id="tabContent" class="min-h-[60vh]">
            
            <!-- Tab: Altar -->
            <section id="tab-altar" class="text-center animate-fade-in">
                <div class="max-w-3xl mx-auto mb-12 p-6 glass rounded-2xl border-amber-500/10">
                    <p class="text-lg italic font-light leading-relaxed text-amber-100/90">
                        ¡Bienvenidos a la Cibercapilla de la Fundación Universitaria Católica del Norte! Nos complace recibirlos en este espacio virtual dedicado a la reflexión, la oración y el encuentro con la persona adorable de Jesucristo.
                    </p>
                </div>

                <div class="space-y-4 mb-8">
                    <h2 class="text-3xl font-light italic">Altar de Intenciones</h2>
                    <p class="text-[10px] uppercase tracking-[0.3em] opacity-40 font-sans">
                        Haz clic sobre una vela para encenderla y realizar la oración
                    </p>
                </div>

                <div class="flex flex-wrap justify-center gap-12 pt-6" id="candlesGrid"></div>
                <div id="candlePrayer" class="mt-12 p-8 rounded-3xl border glass max-w-xl mx-auto hidden shadow-2xl">
                    <p class="text-xl italic font-light leading-relaxed" id="prayerText"></p>
                </div>
            </section>

            <!-- Tab: Eucaristía -->
            <section id="tab-eucaristia" class="hidden-tab max-w-3xl mx-auto space-y-8 animate-fade-in text-center">
                <div class="p-10 rounded-[3rem] border glass">
                    <i data-lucide="video" class="text-amber-500 mx-auto mb-6 w-12 h-12"></i>
                    <h2 class="text-3xl font-bold mb-4">La Santa Eucaristía</h2>
                    <div class="bg-amber-500/10 p-6 rounded-2xl border border-amber-500/20 mb-8">
                        <p class="text-xl font-bold mb-4">Todos los días - 12:00 m. (Col)</p>
                        <a href="https://www.facebook.com/SoyCatolicaDelNorte" target="_blank" class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-full text-sm font-bold transition-all shadow-lg font-sans">
                            Participar en Facebook Live
                        </a>
                    </div>
                    <a href="https://encuestas.ucn.edu.co/index.php/819977" target="_blank" class="text-amber-500 font-bold text-sm underline underline-offset-4 transition-colors font-sans">
                        Enviar intenciones para la Misa
                    </a>
                </div>
            </section>

            <!-- Tab: Rosario -->
            <section id="tab-rosario" class="hidden-tab max-w-3xl mx-auto space-y-8 animate-fade-in">
                <div class="p-6 md:p-10 rounded-[2.5rem] border glass shadow-2xl relative overflow-hidden">
                    <div id="rosaryProgress" class="absolute top-0 left-0 h-1 bg-amber-500 transition-all duration-500" style="width: 0%"></div>
                    <div class="flex justify-between items-center mb-8">
                        <div class="flex flex-col text-left">
                            <span id="rosaryStepIndicator" class="text-[10px] font-bold uppercase tracking-[0.3em] text-amber-500 mb-1 font-sans"></span>
                            <h2 id="rosaryStepTitle" class="text-2xl font-bold"></h2>
                        </div>
                        <button onclick="resetRosary()" class="p-2 opacity-40 hover:opacity-100 transition-opacity">
                            <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="min-h-[250px] flex flex-col justify-center text-center px-4 overflow-y-auto">
                        <p id="rosaryInstruction" class="text-xs uppercase tracking-widest opacity-40 mb-6 font-bold font-sans"></p>
                        <p id="rosaryText" class="text-lg md:text-xl italic leading-relaxed font-light whitespace-pre-line"></p>
                        <div id="rosarySubPrayers" class="mt-8 space-y-4 hidden"></div>
                    </div>
                    <div class="flex justify-between items-center mt-12 pt-8 border-t border-amber-500/10 font-sans">
                        <button id="rosaryPrev" onclick="moveRosary(-1)" class="flex items-center gap-2 text-xs uppercase tracking-widest font-bold hover:text-amber-500 transition-colors disabled:opacity-20">
                            <i data-lucide="chevron-left" class="w-4 h-4"></i> Anterior
                        </button>
                        <button id="rosaryNext" onclick="moveRosary(1)" class="flex items-center gap-2 bg-amber-600 hover:bg-amber-500 text-white px-8 py-3 rounded-full text-xs uppercase tracking-widest font-bold transition-all shadow-lg">
                            Siguiente <i data-lucide="chevron-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
                <p id="rosaryDayInfo" class="text-center text-[10px] opacity-40 font-bold uppercase tracking-widest font-sans mt-4"></p>
            </section>

            <!-- Tab: Coronilla -->
            <section id="tab-coronilla" class="hidden-tab max-w-3xl mx-auto space-y-8 animate-fade-in">
                <div class="p-6 md:p-10 rounded-[2.5rem] border glass shadow-2xl relative overflow-hidden">
                    <div id="coronillaProgress" class="absolute top-0 left-0 h-1 bg-red-600 transition-all duration-500" style="width: 0%"></div>
                    <div class="flex justify-between items-center mb-8">
                        <div class="flex flex-col text-left">
                            <span id="coronillaStepIndicator" class="text-[10px] font-bold uppercase tracking-[0.3em] text-red-500 mb-1 font-sans"></span>
                            <h2 id="coronillaStepTitle" class="text-2xl font-bold">La Divina Misericordia</h2>
                        </div>
                        <button onclick="resetCoronilla()" class="p-2 opacity-40 hover:opacity-100 transition-opacity">
                            <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="min-h-[250px] flex flex-col justify-center text-center px-4 overflow-y-auto">
                        <p id="coronillaInstruction" class="text-xs uppercase tracking-widest opacity-40 mb-6 font-bold font-sans"></p>
                        <p id="coronillaText" class="text-lg md:text-xl italic leading-relaxed font-light whitespace-pre-line"></p>
                        <div id="coronillaSubPrayers" class="mt-8 space-y-4 hidden text-left"></div>
                    </div>
                    <div class="flex justify-between items-center mt-12 pt-8 border-t border-red-500/10 font-sans">
                        <button id="coronillaPrev" onclick="moveCoronilla(-1)" class="flex items-center gap-2 text-xs uppercase tracking-widest font-bold hover:text-red-500 transition-colors disabled:opacity-20">
                            <i data-lucide="chevron-left" class="w-4 h-4"></i> Anterior
                        </button>
                        <button id="coronillaNext" onclick="moveCoronilla(1)" class="flex items-center gap-2 bg-red-700 hover:bg-red-600 text-white px-8 py-3 rounded-full text-xs uppercase tracking-widest font-bold transition-all shadow-lg">
                            Siguiente <i data-lucide="chevron-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Tab: Papa -->
            <section id="tab-papa" class="hidden-tab max-w-3xl mx-auto animate-fade-in">
                <div id="papaIntentionContent" class="p-10 rounded-[3rem] border glass text-center space-y-6">
                    <i data-lucide="globe" class="text-amber-500 mx-auto w-12 h-12"></i>
                    <h3 id="papaMonthName" class="text-amber-600 font-bold uppercase tracking-widest text-xs"></h3>
                    <p id="papaIntentionTitle" class="text-xl font-bold"></p>
                    <p id="papaIntentionDesc" class="text-lg italic opacity-70 leading-relaxed"></p>
                </div>
            </section>

            <!-- Tab: Biblia -->
            <section id="tab-biblia" class="hidden-tab max-w-4xl mx-auto animate-fade-in">
                <div class="mb-6 flex items-center gap-4">
                    <button id="bibleBackBtn" onclick="bibleBack()" class="hidden flex items-center gap-2 text-xs uppercase tracking-widest opacity-60 hover:opacity-100 p-2 font-sans">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i> Volver
                    </button>
                    <h2 id="bibleTitle" class="text-xl font-bold">Biblia Latinoamericana</h2>
                </div>
                <div id="bibleLibrary" class="space-y-10"></div>
                <div id="bibleChapters" class="hidden glass p-8 rounded-3xl border">
                    <p class="text-center opacity-60 mb-8 uppercase tracking-widest text-xs font-sans">Selecciona un capítulo</p>
                    <div id="chapterGrid" class="grid grid-cols-5 sm:grid-cols-8 md:grid-cols-10 gap-2 font-sans"></div>
                </div>
                <div id="bibleReader" class="hidden glass p-8 md:p-12 rounded-[2rem] border min-h-[400px]">
                    <div id="bibleLoading" class="flex flex-col items-center justify-center h-[300px] gap-4">
                        <i data-lucide="refresh-cw" class="w-8 h-8 animate-spin text-amber-500"></i>
                        <p class="text-xs uppercase tracking-widest animate-pulse font-sans">Consultando la Biblia...</p>
                    </div>
                    <div id="bibleContent" class="hidden max-w-2xl mx-auto">
                        <div class="mb-10 pb-6 border-b border-amber-500/10 flex justify-between items-end">
                            <h3 id="readingBookTitle" class="text-3xl font-bold"></h3>
                            <div class="flex gap-2 font-sans">
                                <button onclick="changeChapter(-1)" id="prevChapter" class="p-2 rounded-full hover:bg-amber-500/10"><i data-lucide="chevron-left"></i></button>
                                <button onclick="changeChapter(1)" id="nextChapter" class="p-2 rounded-full hover:bg-amber-500/10"><i data-lucide="chevron-right"></i></button>
                            </div>
                        </div>
                        <div id="readingText" class="text-xl leading-relaxed italic opacity-90 font-light space-y-6"></div>
                    </div>
                    <div id="bibleError" class="hidden text-center py-20 space-y-6">
                        <i data-lucide="alert-circle" class="mx-auto w-12 h-12 text-red-500"></i>
                        <p class="text-lg font-bold">La Biblia requiere configuración</p>
                        <p class="text-sm opacity-60 max-w-md mx-auto font-sans">Para que la Biblia funcione en GitHub, necesitas configurar tu propia Gemini API Key gratuita.</p>
                        <button onclick="openApiModal()" class="bg-amber-600 px-6 py-2 rounded-full text-xs font-bold uppercase tracking-widest font-sans text-white">Configurar ahora</button>
                    </div>
                </div>
            </section>

            <!-- Tab: Peticiones -->
            <section id="tab-muro" class="hidden-tab max-w-2xl mx-auto space-y-6 animate-fade-in">
                <div class="p-8 rounded-3xl border glass font-sans">
                    <h3 class="text-lg font-bold mb-4">Muro de Peticiones</h3>
                    <div class="space-y-4">
                        <textarea id="prayerInput" placeholder="Escribe aquí tu intención..." class="w-full bg-slate-800/10 border border-amber-500/10 rounded-2xl p-4 outline-none h-28 text-sm focus:ring-1 focus:ring-amber-500 transition-all text-white"></textarea>
                        <button onclick="savePrayer()" class="w-full bg-amber-600 text-white py-4 rounded-xl font-bold uppercase tracking-widest text-xs hover:bg-amber-500 transition-colors shadow-lg">Depositar petición</button>
                    </div>
                </div>
                <div id="prayersList" class="space-y-4"></div>
            </section>

        </div>
    </main>

    <footer class="fixed bottom-0 w-full p-4 border-t border-amber-500/10 bg-slate-950/80 z-50 backdrop-blur-md">
        <div class="max-w-5xl mx-auto flex flex-col md:flex-row justify-between items-center px-4 gap-2 text-[10px] uppercase tracking-widest opacity-60 font-bold font-sans">
            <div class="flex items-center gap-2"><i data-lucide="sparkles" class="text-amber-500 w-3 h-3"></i> Católica del Norte</div>
            <div class="italic text-center">"Todo lo puedo en Aquel que me fortalece"</div>
        </div>
    </footer>

    <script>
        // --- Configuración API ---
        let apiKey = localStorage.getItem('ucn_bible_apikey') || ""; 

        function openApiModal() { document.getElementById('apiModal').style.display = 'flex'; }
        function closeApiModal() { document.getElementById('apiModal').style.display = 'none'; }
        function saveApiKey() {
            const val = document.getElementById('apiKeyInput').value;
            if(val) {
                apiKey = val;
                localStorage.setItem('ucn_bible_apikey', val);
                closeApiModal();
                if(selectedBook) readChapter(selectedChapter);
            }
        }

        // --- Estado Global ---
        let currentTab = 'altar';
        let rosaryStep = 0;
        let coronillaStep = 0;
        let selectedBook = null;
        let selectedChapter = 1;
        let litCandles = new Set();
        let peticiones = JSON.parse(localStorage.getItem('peticiones') || '[]');

        // --- Datos ---
        const candles = [
            { id: 1, label: 'Almas del Purgatorio', prayer: 'Que la luz perpetua las ilumine en su descanso eterno. Amén.' },
            { id: 2, label: 'Salud de los Enfermos', prayer: 'Señor Jesús, visita a los que sufren y dales tu alivio soberano. Amén.' },
            { id: 3, label: 'Por las Familias', prayer: 'Sagrada Familia, haz de nuestros hogares iglesias domésticas de paz. Amén.' },
            { id: 4, label: 'Paz en el Mundo', prayer: 'Haz de mí un instrumento de tu paz donde hay guerra. Amén.' },
            { id: 5, label: 'Acción de Gracias', prayer: 'Te damos gracias por el don de la vida y tu amor sin fin. Amén.' },
        ];

        const papaIntentions = [
            { month: "Enero", title: "Por los educadores", desc: "Oremos para que los educadores sean testigos creíbles, enseñando la fraternidad en lugar de la confrontación." },
            { month: "Febrero", title: "Por los enfermos terminales", desc: "Oremos para que los enfermos terminales y sus familias reciban siempre los cuidados y el acompañamiento necesarios." },
            { month: "Marzo", title: "Por los nuevos mártires", desc: "Oremos para que quienes en diversas partes del mundo arriesgan su vida por el Evangelio contagien a la Iglesia su valentía." },
            { month: "Abril", title: "Por el papel de la mujer", desc: "Oremos para que la dignidad y la riqueza de las mujeres sean reconocidas en todas las culturas." },
            { month: "Mayo", title: "Por la formación de religiosos y seminaristas", desc: "Oremos para que los religiosos, las religiosas y los seminaristas crezcan en su camino vocacional." },
            { month: "Junio", title: "Por los que huyen de su país", desc: "Oremos para que los migrantes que huyen de las guerras o del hambre encuentren aceptación y nuevas oportunidades." },
            { month: "Julio", title: "Por los ancianos", desc: "Oremos para que los ancianos sean valorados por su experiencia y sabiduría." },
            { month: "Agosto", title: "Por los líderes políticos", desc: "Oremos para que los líderes políticos estén al servicio de su propio pueblo, trabajando por el desarrollo humano integral." },
            { month: "Septiembre", title: "Por el clamor de la Tierra", desc: "Oremos para que cada uno de nosotros escuche con el corazón el clamor de la Tierra y de las víctimas de catástrofes." },
            { month: "Octubre", title: "Por una misión compartida", desc: "Oremos para que la Iglesia siga apoyando un estilo de vida sinodal, bajo el signo de la corresponsabilidad." },
            { month: "Noviembre", title: "Por quienes han perdido un hijo", desc: "Oremos para que todos los padres que lloran la muerte de un hijo encuentren apoyo en la comunidad." },
            { month: "Diciembre", title: "Por los voluntarios", desc: "Oremos para que las organizaciones de voluntariado y promoción humana encuentren personas deseosas de comprometerse." }
        ];

        const bibleData = {
            "Nuevo Testamento": [
                { name: "Mateo", chapters: 28, isGospel: true }, { name: "Marcos", chapters: 16, isGospel: true }, { name: "Lucas", chapters: 24, isGospel: true }, { name: "Juan", chapters: 21, isGospel: true },
                { name: "Hechos", chapters: 28 }, { name: "Romanos", chapters: 16 }, { name: "1 Corintios", chapters: 16 }, { name: "2 Corintios", chapters: 13 },
                { name: "Gálatas", chapters: 6 }, { name: "Efesios", chapters: 6 }, { name: "Apocalipsis", chapters: 22 }
            ],
            "Antiguo Testamento": [
                { name: "Génesis", chapters: 50 }, { name: "Éxodo", chapters: 40 }, { name: "Levítico", chapters: 27 }, { name: "Números", chapters: 36 }, { name: "Deuteronomio", chapters: 34 },
                { name: "Salmos", chapters: 150 }, { name: "Sabiduría", chapters: 19, isCatholicOnly: true }, { name: "Sirácide", chapters: 51, isCatholicOnly: true }
            ]
        };

        const oracionesRosario = [
            { title: "Inicio", instruction: "Señal de la Cruz", text: "Por la señal de la Santa Cruz, de nuestros enemigos líbranos, Señor. En el nombre del Padre..." },
            { title: "Misterio 1", instruction: "Meditemos", text: "Primer misterio del día..." },
            { title: "Misterio 2", instruction: "Meditemos", text: "Segundo misterio del día..." },
            { title: "Misterio 3", instruction: "Meditemos", text: "Tercer misterio del día..." },
            { title: "Misterio 4", instruction: "Meditemos", text: "Cuarto misterio del día..." },
            { title: "Misterio 5", instruction: "Meditemos", text: "Quinto misterio del día..." },
            { title: "Final", instruction: "Salve Regina", text: "Dios te salve, Reina y Madre de misericordia..." }
        ];

        const coronillaSteps = [
            { title: "Inicio", instruction: "Señal de la Cruz", text: "En el nombre del Padre, y del Hijo, y del Espíritu Santo. Amén." },
            { title: "Oraciones iniciales", instruction: "Padre Nuestro, Ave María y Credo", text: "Padre Nuestro, que estás en el cielo...\nDios te salve, María...\nCreo en Dios, Padre Todopoderoso..." },
            { title: "Decena 1", instruction: "Padre Eterno", text: "Padre Eterno, te ofrezco el Cuerpo y la Sangre, el Alma y la Divinidad de tu amadísimo Hijo, Nuestro Señor Jesucristo..." },
            { title: "Decena 2", instruction: "Padre Eterno", text: "Padre Eterno, te ofrezco el Cuerpo y la Sangre..." },
            { title: "Decena 3", instruction: "Padre Eterno", text: "Padre Eterno, te ofrezco el Cuerpo y la Sangre..." },
            { title: "Decena 4", instruction: "Padre Eterno", text: "Padre Eterno, te ofrezco el Cuerpo y la Sangre..." },
            { title: "Decena 5", instruction: "Padre Eterno", text: "Padre Eterno, te ofrezco el Cuerpo y la Sangre..." },
            { title: "Conclusión", instruction: "Santo Dios (3 veces)", text: "Santo Dios, Santo Fuerte, Santo Inmortal, ten piedad de nosotros y del mundo entero." }
        ];

        // --- Funciones Principales ---

        window.onload = () => {
            lucide.createIcons();
            renderCandles();
            renderBibleLibrary();
            renderPrayers();
            updateRosary();
            updateCoronilla();
            updatePapaIntention();
            setupTheme();
        };

        function switchTab(tabId) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden-tab'));
            const target = document.getElementById(`tab-${tabId}`);
            if(target) target.classList.remove('hidden-tab');
            
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-tab'));
            const clickedBtn = Array.from(document.querySelectorAll('.nav-btn')).find(b => b.getAttribute('onclick').includes(tabId));
            if(clickedBtn) clickedBtn.classList.add('active-tab');
            currentTab = tabId;
        }

        function renderCandles() {
            const grid = document.getElementById('candlesGrid');
            if(!grid) return;
            grid.innerHTML = candles.map(c => {
                const isLit = litCandles.has(c.id);
                return `
                <div class="candle-container">
                    <button onclick="toggleCandle(${c.id})" class="flex flex-col items-center group relative">
                        <div class="relative h-32 flex flex-col items-center justify-end">
                            <div class="absolute top-0 w-16 h-16 bg-amber-400/20 rounded-full blur-xl transition-opacity duration-1000 ${isLit ? 'opacity-100' : 'opacity-0'}"></div>
                            <div class="relative ${isLit ? '' : 'hidden'}">
                                <div class="candle-wick"></div>
                                <div class="candle-flame"></div>
                            </div>
                            <div class="candle-body ${isLit ? 'glow-effect' : ''}" style="background: radial-gradient(circle at 50% 0%, ${isLit ? '#fff' : '#fffdf2'} 0%, #fffdf2 100%); opacity: ${isLit ? '1' : '0.6'}; border: 1px solid rgba(0,0,0,0.05);"></div>
                        </div>
                        <span class="mt-4 text-[10px] font-bold uppercase tracking-widest transition-colors ${isLit ? 'text-amber-500' : 'opacity-40'}">${c.label}</span>
                    </button>
                </div>`;
            }).join('');
        }

        function toggleCandle(id) {
            if (litCandles.has(id)) litCandles.delete(id); else litCandles.add(id);
            const candle = candles.find(c => c.id === id);
            const prayerEl = document.getElementById('candlePrayer');
            if(litCandles.has(id)) {
                prayerEl.classList.remove('hidden');
                document.getElementById('prayerText').innerText = `"${candle.prayer}"`;
            } else {
                prayerEl.classList.add('hidden');
            }
            renderCandles();
        }

        // --- Rosario ---
        function updateRosary() {
            const step = oracionesRosario[rosaryStep];
            const indicator = document.getElementById('rosaryStepIndicator');
            const title = document.getElementById('rosaryStepTitle');
            const inst = document.getElementById('rosaryInstruction');
            const txt = document.getElementById('rosaryText');
            const prog = document.getElementById('rosaryProgress');
            
            if(indicator) indicator.innerText = `Paso ${rosaryStep + 1} de ${oracionesRosario.length}`;
            if(title) title.innerText = step.title;
            if(inst) inst.innerText = step.instruction;
            if(txt) txt.innerText = step.text;
            if(prog) prog.style.width = `${((rosaryStep + 1) / oracionesRosario.length) * 100}%`;
            
            const dayInfo = document.getElementById('rosaryDayInfo');
            if(dayInfo) {
                const day = new Date().toLocaleDateString('es-ES', { weekday: 'long' });
                dayInfo.innerText = `Hoy es ${day}`;
            }
        }
        function moveRosary(dir) {
            rosaryStep = Math.max(0, Math.min(oracionesRosario.length - 1, rosaryStep + dir));
            updateRosary();
        }
        function resetRosary() { rosaryStep = 0; updateRosary(); }

        // --- Coronilla ---
        function updateCoronilla() {
            const step = coronillaSteps[coronillaStep];
            const indicator = document.getElementById('coronillaStepIndicator');
            const title = document.getElementById('coronillaStepTitle');
            const inst = document.getElementById('coronillaInstruction');
            const txt = document.getElementById('coronillaText');
            const prog = document.getElementById('coronillaProgress');
            
            if(indicator) indicator.innerText = `Paso ${coronillaStep + 1} de ${coronillaSteps.length}`;
            if(title) title.innerText = step.title;
            if(inst) inst.innerText = step.instruction;
            if(txt) txt.innerText = step.text;
            if(prog) prog.style.width = `${((coronillaStep + 1) / coronillaSteps.length) * 100}%`;
        }
        function moveCoronilla(dir) {
            coronillaStep = Math.max(0, Math.min(coronillaSteps.length - 1, coronillaStep + dir));
            updateCoronilla();
        }
        function resetCoronilla() { coronillaStep = 0; updateCoronilla(); }

        // --- Papa ---
        function updatePapaIntention() {
            const current = papaIntentions[new Date().getMonth()];
            const monthEl = document.getElementById('papaMonthName');
            const titleEl = document.getElementById('papaIntentionTitle');
            const descEl = document.getElementById('papaIntentionDesc');
            if(monthEl) monthEl.innerText = current.month;
            if(titleEl) titleEl.innerText = current.title;
            if(descEl) descEl.innerText = current.desc;
        }

        // --- Biblia ---
        function renderBibleLibrary() {
            const lib = document.getElementById('bibleLibrary');
            if(!lib) return;
            lib.innerHTML = Object.entries(bibleData).map(([test, books]) => `
                <div>
                    <h3 class="text-amber-500 uppercase tracking-widest text-[10px] font-bold mb-4 border-b border-amber-500/10 pb-2">${test}</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 font-sans">
                        ${books.map(b => `<button onclick="openBook('${b.name}', ${b.chapters})" class="p-3 glass rounded-xl text-sm font-bold text-left hover:border-amber-500 transition-colors ${b.isGospel ? 'gospel-highlight' : ''}">${b.name}</button>`).join('')}
                    </div>
                </div>`).join('');
            lucide.createIcons();
        }

        function openBook(name, chapters) {
            selectedBook = { name, chapters };
            document.getElementById('bibleLibrary').classList.add('hidden');
            document.getElementById('bibleChapters').classList.remove('hidden');
            document.getElementById('bibleBackBtn').classList.remove('hidden');
            document.getElementById('bibleTitle').innerText = name;
            const grid = document.getElementById('chapterGrid');
            grid.innerHTML = Array.from({ length: chapters }, (_, i) => i + 1).map(num => `<button onclick="readChapter(${num})" class="p-2 glass rounded-lg text-xs font-bold hover:bg-amber-500 transition-colors">${num}</button>`).join('');
        }

        async function readChapter(num) {
            selectedChapter = num;
            document.getElementById('bibleChapters').classList.add('hidden');
            document.getElementById('bibleReader').classList.remove('hidden');
            document.getElementById('bibleLoading').classList.remove('hidden');
            document.getElementById('bibleContent').classList.add('hidden');
            document.getElementById('bibleError').classList.add('hidden');

            if (!apiKey) {
                document.getElementById('bibleLoading').classList.add('hidden');
                document.getElementById('bibleError').classList.remove('hidden');
                return;
            }

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: `Texto Biblia Latinoamericana Católica: ${selectedBook.name} capítulo ${num}. Devuelve solo los versículos, sin comentarios ni introducciones.` }] }] })
                });
                const data = await res.json();
                if (data.error) throw new Error();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "No se pudo cargar el texto sagrado.";
                document.getElementById('bibleLoading').classList.add('hidden');
                document.getElementById('bibleContent').classList.remove('hidden');
                document.getElementById('readingBookTitle').innerText = `${selectedBook.name} ${num}`;
                document.getElementById('readingText').innerText = text;
            } catch {
                document.getElementById('bibleLoading').classList.add('hidden');
                document.getElementById('bibleError').classList.remove('hidden');
            }
        }

        function bibleBack() {
            if (!document.getElementById('bibleReader').classList.contains('hidden')) {
                document.getElementById('bibleReader').classList.add('hidden');
                document.getElementById('bibleChapters').classList.remove('hidden');
            } else {
                document.getElementById('bibleChapters').classList.add('hidden');
                document.getElementById('bibleLibrary').classList.remove('hidden');
                document.getElementById('bibleBackBtn').classList.add('hidden');
                document.getElementById('bibleTitle').innerText = "Biblia Latinoamericana";
            }
        }

        function changeChapter(dir) {
            const next = selectedChapter + dir;
            if(next > 0 && next <= selectedBook.chapters) readChapter(next);
        }

        // --- Peticiones ---
        function renderPrayers() {
            const list = document.getElementById('prayersList');
            if(!list) return;
            list.innerHTML = peticiones.map(p => `<div class="p-4 glass rounded-xl italic text-sm mb-3 border-l-2 border-amber-500/20">"${p.text}"</div>`).join('');
        }

        function savePrayer() {
            const input = document.getElementById('prayerInput');
            if (input.value.trim()) {
                peticiones.unshift({ text: input.value });
                localStorage.setItem('peticiones', JSON.stringify(peticiones));
                input.value = '';
                renderPrayers();
            }
        }

        // --- Tema ---
        function setupTheme() {
            const btn = document.getElementById('themeToggle');
            if(!btn) return;
            btn.onclick = () => {
                const isDark = document.body.classList.contains('bg-slate-950');
                if(isDark) {
                    document.body.className = 'bg-stone-50 text-stone-900 min-h-screen pb-20 light';
                    document.getElementById('themeIcon').setAttribute('data-lucide', 'moon');
                } else {
                    document.body.className = 'bg-slate-950 text-slate-200 min-h-screen pb-20 overflow-x-hidden';
                    document.getElementById('themeIcon').setAttribute('data-lucide', 'sun');
                }
                lucide.createIcons();
            };
        }
    </script>
</body>
</html>
